#!/bin/bash

# parse the command-line
DEFINE_string 'region' 'us-east-1' 'AWS region' 'R'
DEFINE_string 'disk' 'ebs' 'AWS disk type' 'B'
DEFINE_string 'arch' 'amd64' 'AWS arch' 'a'
DEFINE_string 'instype' 'm1.large' "AWS instance type" "T"
DEFINE_string 'release' 'precise' 'Ubuntu release' 'U'
DEFINE_string 'sshauth' "$HOME/.ssh/authorized_keys" 'Authorized ssh keys' 's'
DEFINE_boolean 'sshagent' "$FLAGS_FALSE" 'Forward ssh agent' 'A'
DEFINE_string 'bootstrap' "$shome/bootstrap/bootstrap.sh" 'Bootstrap script' 'b'

function pick_ami {
	# This selects the most recent release Ubuntu cloud image
  curl -s http://cloud-images.ubuntu.com/rss/${FLAGS_release}-release.xml | \
    awk '$1 ~ /^<br>/ { sub(/^<br>/, "", $0); print }' | \
    awk -v region="$FLAGS_region" -v disk="$FLAGS_disk" -v arch="$FLAGS_arch" '$1 == region && $3 == arch && $4 == disk { ami = $2 } END { print ami }'
}
